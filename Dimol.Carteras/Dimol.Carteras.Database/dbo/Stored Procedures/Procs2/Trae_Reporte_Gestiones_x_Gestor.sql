create Procedure Trae_Reporte_Gestiones_x_Gestor(@ctc_codemp integer, @desde datetime, @hasta datetime, @aci_idid integer, @gestores varchar(200)) as  DECLARE  @SQL varchar(8000)  DECLARE  @SQL2 varchar(8000)  DECLARE  @SQL3 varchar(8000)    DECLARE  @SQL4 varchar(8000)  DECLARE  @SQL5 varchar(8000)  DECLARE  @SQL6 varchar(8000)      set @SQL = ' SELECT DISTINCT pcl_rut,  '   set @SQL =  @SQL + '   pcl_nomfant,   '  set @SQL =  @SQL + '  ctc_rut,   '  set @SQL =  @SQL + '  ctc_nomfant,'     set @SQL =  @SQL + '   cea_fecha,   '  set @SQL =  @SQL + '  aci_nombre,   '  set @SQL =  @SQL + '  ges_nombre,   '  set @SQL =  @SQL + '   substring(cea_comentario, 1, 1000) as Comentario  '  set @SQL =  @SQL + '     FROM cartera_clientes,   '  set @SQL =  @SQL + '   provcli,   '  set @SQL =  @SQL + '   deudores,   '  set @SQL =  @SQL + '   cartera_clientes_estados_acciones,   '  set @SQL =  @SQL + '   acciones_idiomas,   '  set @SQL =  @SQL + '   gestor  '  set @SQL =  @SQL + '    WHERE  pcl_codemp = cartera_clientes.ctc_codemp  and  '  set @SQL =  @SQL + '    pcl_pclid = cartera_clientes.ctc_pclid  and  '  set @SQL =  @SQL + '   deudores.ctc_codemp = cartera_clientes.ctc_codemp  and'    set @SQL =  @SQL + '   deudores.ctc_ctcid = cartera_clientes.ctc_ctcid  and  '  set @SQL2 = '    cartera_clientes.ctc_codemp = cea_codemp  and  '  set @SQL2 =  @SQL2 + '    cartera_clientes.ctc_pclid = cea_pclid  and  '  set @SQL2 =  @SQL2 + '    cartera_clientes.ctc_ctcid = cea_ctcid  and  '  set @SQL2 =  @SQL2 + '    cea_codemp =aci_codemp  and '   set @SQL2 =  @SQL2 + '    cea_accid =aci_accid  and  '  set @SQL2 =  @SQL2 + '   ges_codemp = cea_codemp  and  '  set @SQL2 =  @SQL2 + '   ges_sucid = cea_sucid  and  '  set @SQL2 =  @SQL2 + '   ges_gesid = cea_gesid  and  '  set @SQL3 =  '    cartera_clientes.ctc_codemp =' + convert(varchar, @ctc_codemp) +  '  AND  '  set @SQL3 =  @SQL3 + '    cea_fecha >= ''' + CAST(CONVERT(VARCHAR(30),  @desde, 103)  as varchar) + ' 00:00:00'''  set @SQL3 =  @SQL3 + '    and cea_fecha <= ''' + CAST(CONVERT(VARCHAR(30),  @hasta, 103)  as varchar) + ' 23:59:59'''  set @SQL3 =  @SQL3 + '    and aci_idid =' + convert(varchar,  @aci_idid) + '    and ges_gesid in (' +@gestores + ')'    set @SQL4 =  ' UNION   '  set @SQL4 =  @SQL4 + '  SELECT DISTINCT pcl_rut,   '  set @SQL4 =  @SQL4 + '  pcl_nomfant,   '  set @SQL4 =  @SQL4 + ' ctc_rut,   '  set @SQL4 =  @SQL4 + ' ctc_nomfant,'     set @SQL4 =  @SQL4 + ' ceh_fecha,   '  set @SQL4 =  @SQL4 + '  eci_nombre,   '  set @SQL4 =  @SQL4 + ' ges_nombre,   '  set @SQL4 =  @SQL4 + '  substring(ceh_comentario, 1, 1000) as comentario  '  set @SQL4 =  @SQL4 + '    FROM cartera_clientes,   '  set @SQL4 =  @SQL4 + '  provcli,   '  set @SQL4 =  @SQL4 + '  deudores,   '  set @SQL4 =  @SQL4 + '  cartera_clientes_estados_historial,   '  set @SQL4 =  @SQL4 + '  gestor,   '  set @SQL4 =  @SQL4 + '  estados_cartera_idiomas  '  set @SQL5 =  '   WHERE  pcl_codemp = cartera_clientes.ctc_codemp  and  '  set @SQL5 =  @SQL5 + '   pcl_pclid = cartera_clientes.ctc_pclid  and  '  set @SQL5 =  @SQL5 + '  deudores.ctc_codemp = cartera_clientes.ctc_codemp  and  '  set @SQL5 =  @SQL5 + '  deudores.ctc_ctcid = cartera_clientes.ctc_ctcid  and  '  set @SQL5 =  @SQL5 + '  ges_codemp =ceh_codemp  and  '  set @SQL5 =  @SQL5 + '  ges_sucid =ceh_sucid  and  '  set @SQL5 =  @SQL5 + '  ges_gesid =ceh_gesid  and  '  set @SQL5 =  @SQL5 + '   cartera_clientes.ctc_codemp =ceh_codemp  and  '  set @SQL5 =  @SQL5 + '   cartera_clientes.ctc_pclid =ceh_pclid  and  '  set @SQL5 =  @SQL5 + '   cartera_clientes.ctc_ctcid =ceh_ctcid  and  '  set @SQL5 =  @SQL5 + '  ceh_codemp = eci_codemp  and  '  set @SQL5 =  @SQL5 + '  ceh_estid = eci_estid  and  '  set @SQL6 =  '    cartera_clientes.ctc_codemp =' + convert(varchar, @ctc_codemp) +  '  AND  '  set @SQL6 =  @SQL6 + '  ceh_fecha >= ''' + CAST(CONVERT(VARCHAR(30),  @desde, 103)  as varchar) + ' 00:00:00'''  set @SQL6 =  @SQL6 + '   and ceh_fecha <=  ''' + CAST(CONVERT(VARCHAR(30),  @hasta, 103)  as varchar) + ' 23:59:59'''  set @SQL6 =  @SQL6 + '   and eci_idid =' + convert(varchar,  @aci_idid) + ' and ges_gesid in (' +@gestores + ')'  set @SQL6 =  @SQL6 + '    '    exec  (@SQL + @SQL2 + @SQL3 + @SQL4 + @SQL5 + @SQL6)